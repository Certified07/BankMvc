@* @model BankMvc.DTO.ViewModels.AllTransactionsViewModel *@
@* @{ *@
@*     ViewData["Title"] = "All Transactions"; *@
@*     Layout = "~/Views/Shared/_Layout.cshtml"; *@
@* } *@

@* <div class="container-fluid py-4"> *@
@*     <!-- Page Header --> *@
@*     <div class="row mb-4"> *@
@*         <div class="col-12"> *@
@*             <div class="card shadow-sm border-0"> *@
@*                 <div class="card-body"> *@
@*                     <div class="d-flex justify-content-between align-items-center"> *@
@*                         <div> *@
@*                             <h2 class="mb-1 text-primary"> *@
@*                                 <i class="fas fa-list-alt me-2"></i>All Transactions *@
@*                             </h2> *@
@*                             <p class="text-muted mb-0">View all your transaction history across all accounts</p> *@
@*                         </div> *@
@*                         <div> *@
@*                             <a href="@Url.Action("Dashboard", "Account")" class="btn btn-outline-primary"> *@
@*                                 <i class="fas fa-arrow-left me-1"></i>Back to Dashboard *@
@*                             </a> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@

@*     <!-- Statistics Cards --> *@
@*     <div class="row mb-4"> *@
@*         <div class="col-md-3 col-sm-6 mb-3"> *@
@*             <div class="card bg-success text-white shadow-sm border-0"> *@
@*                 <div class="card-body"> *@
@*                     <div class="d-flex align-items-center"> *@
@*                         <div class="flex-grow-1"> *@
@*                             <h6 class="card-title mb-1">Total Credit</h6> *@
@*                             <h4 class="mb-0" id="totalCredit">₦0.00</h4> *@
@*                         </div> *@
@*                         <div class="ms-3"> *@
@*                             <i class="fas fa-arrow-up fa-2x opacity-75"></i> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*         <div class="col-md-3 col-sm-6 mb-3"> *@
@*             <div class="card bg-danger text-white shadow-sm border-0"> *@
@*                 <div class="card-body"> *@
@*                     <div class="d-flex align-items-center"> *@
@*                         <div class="flex-grow-1"> *@
@*                             <h6 class="card-title mb-1">Total Debit</h6> *@
@*                             <h4 class="mb-0" id="totalDebit">₦0.00</h4> *@
@*                         </div> *@
@*                         <div class="ms-3"> *@
@*                             <i class="fas fa-arrow-down fa-2x opacity-75"></i> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*         <div class="col-md-3 col-sm-6 mb-3"> *@
@*             <div class="card bg-info text-white shadow-sm border-0"> *@
@*                 <div class="card-body"> *@
@*                     <div class="d-flex align-items-center"> *@
@*                         <div class="flex-grow-1"> *@
@*                             <h6 class="card-title mb-1">Net Amount</h6> *@
@*                             <h4 class="mb-0" id="netAmount">₦0.00</h4> *@
@*                         </div> *@
@*                         <div class="ms-3"> *@
@*                             <i class="fas fa-balance-scale fa-2x opacity-75"></i> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*         <div class="col-md-3 col-sm-6 mb-3"> *@
@*             <div class="card bg-warning text-white shadow-sm border-0"> *@
@*                 <div class="card-body"> *@
@*                     <div class="d-flex align-items-center"> *@
@*                         <div class="flex-grow-1"> *@
@*                             <h6 class="card-title mb-1">Total Transactions</h6> *@
@*                             <h4 class="mb-0" id="totalTransactions">@Model.Transactions.Count</h4> *@
@*                         </div> *@
@*                         <div class="ms-3"> *@
@*                             <i class="fas fa-receipt fa-2x opacity-75"></i> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@

@*     <!-- Filters and Search --> *@
@*     <div class="row mb-4"> *@
@*         <div class="col-12"> *@
@*             <div class="card shadow-sm border-0"> *@
@*                 <div class="card-body"> *@
@*                     <div class="row g-3"> *@
@*                         <div class="col-md-3"> *@
@*                             <label for="searchInput" class="form-label">Search</label> *@
@*                             <input type="text" class="form-control" id="searchInput" placeholder="Search description..."> *@
@*                         </div> *@
@*                         <div class="col-md-3"> *@
@*                             <label for="accountFilter" class="form-label">Account</label> *@
@*                             <select class="form-select" id="accountFilter"> *@
@*                                 <option value="">All Accounts</option> *@
@*                                 @foreach (var account in Model.Accounts) *@
@*                                 { *@
@*                                         <option value="@account.AccountId">@account.AccountNumber - @account.AccountType</option> *@
@*                                 } *@
@*                             </select> *@
@*                         </div> *@
@*                         <div class="col-md-2"> *@
@*                             <label for="typeFilter" class="form-label">Type</label> *@
@*                             <select class="form-select" id="typeFilter"> *@
@*                                 <option value="">All Types</option> *@
@*                                 <option value="Credit">Credit</option> *@
@*                                 <option value="Debit">Debit</option> *@
@*                             </select> *@
@*                         </div> *@
@*                         <div class="col-md-2"> *@
@*                             <label for="dateFrom" class="form-label">From Date</label> *@
@*                             <input type="date" class="form-control" id="dateFrom"> *@
@*                         </div> *@
@*                         <div class="col-md-2"> *@
@*                             <label for="dateTo" class="form-label">To Date</label> *@
@*                             <input type="date" class="form-control" id="dateTo"> *@
@*                         </div> *@
@*                     </div> *@
@*                     <div class="row mt-3"> *@
@*                         <div class="col-12"> *@
@*                             <button type="button" class="btn btn-primary me-2" onclick="applyFilters()"> *@
@*                                 <i class="fas fa-filter me-1"></i>Apply Filters *@
@*                             </button> *@
@*                             <button type="button" class="btn btn-outline-secondary" onclick="clearFilters()"> *@
@*                                 <i class="fas fa-times me-1"></i>Clear Filters *@
@*                             </button> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@

@*     <!-- Transactions Table --> *@
@*     <div class="row"> *@
@*         <div class="col-12"> *@
@*             <div class="card shadow-sm border-0"> *@
@*                 <div class="card-header bg-white border-bottom"> *@
@*                     <div class="d-flex justify-content-between align-items-center"> *@
@*                         <h5 class="mb-0">Transaction History</h5> *@
@*                         <div> *@
@*                             <button class="btn btn-outline-success btn-sm me-2" onclick="exportToCSV()"> *@
@*                                 <i class="fas fa-download me-1"></i>Export CSV *@
@*                             </button> *@
@*                             <span class="badge bg-primary" id="filteredCount">@Model.Transactions.Count transactions</span> *@
@*                         </div> *@
@*                     </div> *@
@*                 </div> *@
@*                 <div class="card-body p-0"> *@
@*                     @if (Model.Transactions.Any()) *@
@*                     { *@
@*                             <div class="table-responsive"> *@
@*                                 <table class="table table-hover mb-0" id="transactionsTable"> *@
@*                                     <thead class="table-light"> *@
@*                                         <tr> *@
@*                                             <th style="width: 12%;">Date</th> *@
@*                                             <th style="width: 20%;">Account</th> *@
@*                                             <th style="width: 30%;">Description</th> *@
@*                                             <th style="width: 10%;">Type</th> *@
@*                                             <th style="width: 15%;" class="text-end">Amount</th> *@
@*                                             <th style="width: 13%;" class="text-center">Actions</th> *@
@*                                         </tr> *@
@*                                     </thead> *@
@*                                     <tbody> *@
@*                                     @foreach (var transaction in Model.Transactions) *@
@*                                     { *@
@*                                                 <tr class="transaction-row"  *@
@*                                                     data-account-id="@transaction.AccountId"  *@
@*                                                     data-type="@transaction.TransactionType"  *@
@*                                                     data-date="@transaction.TransactionDate.ToString("yyyy-MM-dd")" *@
@*                                                     data-amount="@transaction.Amount"> *@
@*                                                     <td> *@
@*                                                         <small class="text-muted d-block">@transaction.TransactionDate.ToString("MMM dd, yyyy")</small> *@
@*                                                         <small class="text-muted">@transaction.TransactionDate.ToString("hh:mm tt")</small> *@
@*                                                     </td> *@
@*                                                     <td> *@
@*                                                 @{ *@
@*                                                     var account = Model.Accounts.FirstOrDefault(a => a.AccountId == transaction.AccountId); *@
@*                                                 } *@
@*                                                 @if (account != null) *@
@*                                                 { *@
@*                                                                 <div> *@
@*                                                                     <strong>@account.AccountNumber</strong> *@
@*                                                                     <br><small class="text-muted">@account.AccountType</small> *@
@*                                                                 </div> *@
@*                                                 } *@
@*                                                     </td> *@
@*                                                     <td> *@
@*                                                         <div class="d-flex align-items-center"> *@
@*                                                     @if (transaction.TransactionType == "Credit") *@
@*                                                     { *@
@*                                                                     <i class="fas fa-arrow-up text-success me-2"></i> *@
@*                                                     } *@
@*                                                     else *@
@*                                                     { *@
@*                                                                     <i class="fas fa-arrow-down text-danger me-2"></i> *@
@*                                                     } *@
@*                                                             <span>@transaction.Description</span> *@
@*                                                         </div> *@
@*                                                     </td> *@
@*                                                     <td> *@
@*                                                 @if (transaction.TransactionType == "Credit") *@
@*                                                 { *@
@*                                                                 <span class="badge bg-success">Credit</span> *@
@*                                                 } *@
@*                                                 else *@
@*                                                 { *@
@*                                                                 <span class="badge bg-danger">Debit</span> *@
@*                                                 } *@
@*                                                     </td> *@
@*                                                     <td class="text-end"> *@
@*                                                 @if (transaction.TransactionType == "Credit") *@
@*                                                 { *@
@*                                                                 <span class="text-success fw-bold">+₦@transaction.Amount.ToString("N2")</span> *@
@*                                                 } *@
@*                                                 else *@
@*                                                 { *@
@*                                                                 <span class="text-danger fw-bold">-₦@Math.Abs(transaction.Amount).ToString("N2")</span> *@
@*                                                 } *@
@*                                                     </td> *@
@*                                                     <td class="text-center"> *@
@*                                                         <button class="btn btn-outline-primary btn-sm" onclick="viewTransactionDetails(@transaction.TransactionId)"> *@
@*                                                             <i class="fas fa-eye"></i> *@
@*                                                         </button> *@
@*                                                     </td> *@
@*                                                 </tr> *@
@*                                     } *@
@*                                     </tbody> *@
@*                                 </table> *@
@*                             </div> *@
@*                     } *@
@*                     else *@
@*                     { *@
@*                             <div class="text-center py-5"> *@
@*                                 <i class="fas fa-receipt fa-3x text-muted mb-3"></i> *@
@*                                 <h5 class="text-muted">No transactions found</h5> *@
@*                                 <p class="text-muted">You haven't made any transactions yet.</p> *@
@*                             </div> *@
@*                     } *@
@*                 </div> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@

@* <!-- Transaction Details Modal --> *@
@* <div class="modal fade" id="transactionDetailsModal" tabindex="-1"> *@
@*     <div class="modal-dialog modal-lg"> *@
@*         <div class="modal-content"> *@
@*             <div class="modal-header"> *@
@*                 <h5 class="modal-title">Transaction Details</h5> *@
@*                 <button type="button" class="btn-close" data-bs-dismiss="modal"></button> *@
@*             </div> *@
@*             <div class="modal-body" id="transactionDetailsContent"> *@
@*                 <!-- Transaction details will be loaded here --> *@
@*             </div> *@
@*             <div class="modal-footer"> *@
@*                 <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button> *@
@*             </div> *@
@*         </div> *@
@*     </div> *@
@* </div> *@

@* @section Scripts { *@
@*         <script> *@
@*             document.addEventListener('DOMContentLoaded', function() { *@
@*                 calculateStatistics(); *@
@*             }); *@

@*             function calculateStatistics() { *@
@*                 const rows = document.querySelectorAll('.transaction-row:not([style*="display: none"])'); *@
@*                 let totalCredit = 0; *@
@*                 let totalDebit = 0; *@

@*                 rows.forEach(row => { *@
@*                     const amount = parseFloat(row.getAttribute('data-amount')); *@
@*                     const type = row.getAttribute('data-type'); *@

@*                     if (type === 'Credit') { *@
@*                         totalCredit += amount; *@
@*                     } else { *@
@*                         totalDebit += Math.abs(amount); *@
@*                     } *@
@*                 }); *@

@*                 const netAmount = totalCredit - totalDebit; *@

@*                 document.getElementById('totalCredit').textContent = '₦' + totalCredit.toLocaleString('en-NG', {minimumFractionDigits: 2}); *@
@*                 document.getElementById('totalDebit').textContent = '₦' + totalDebit.toLocaleString('en-NG', {minimumFractionDigits: 2}); *@
@*                 document.getElementById('netAmount').textContent = '₦' + netAmount.toLocaleString('en-NG', {minimumFractionDigits: 2}); *@
@*                 document.getElementById('totalTransactions').textContent = rows.length; *@
@*                 document.getElementById('filteredCount').textContent = rows.length + ' transactions'; *@
@*             } *@

@*             function applyFilters() { *@
@*                 const searchTerm = document.getElementById('searchInput').value.toLowerCase(); *@
@*                 const accountFilter = document.getElementById('accountFilter').value; *@
@*                 const typeFilter = document.getElementById('typeFilter').value; *@
@*                 const dateFrom = document.getElementById('dateFrom').value; *@
@*                 const dateTo = document.getElementById('dateTo').value; *@

@*                 const rows = document.querySelectorAll('.transaction-row'); *@

@*                 rows.forEach(row => { *@
@*                     let show = true; *@

@*                     // Search filter *@
@*                     if (searchTerm) { *@
@*                         const description = row.querySelector('td:nth-child(3)').textContent.toLowerCase(); *@
@*                         if (!description.includes(searchTerm)) { *@
@*                             show = false; *@
@*                         } *@
@*                     } *@

@*                     // Account filter *@
@*                     if (accountFilter && row.getAttribute('data-account-id') !== accountFilter) { *@
@*                         show = false; *@
@*                     } *@

@*                     // Type filter *@
@*                     if (typeFilter && row.getAttribute('data-type') !== typeFilter) { *@
@*                         show = false; *@
@*                     } *@

@*                     // Date filters *@
@*                     const rowDate = row.getAttribute('data-date'); *@
@*                     if (dateFrom && rowDate < dateFrom) { *@
@*                         show = false; *@
@*                     } *@
@*                     if (dateTo && rowDate > dateTo) { *@
@*                         show = false; *@
@*                     } *@

@*                     row.style.display = show ? '' : 'none'; *@
@*                 }); *@

@*                 calculateStatistics(); *@
@*             } *@

@*             function clearFilters() { *@
@*                 document.getElementById('searchInput').value = ''; *@
@*                 document.getElementById('accountFilter').value = ''; *@
@*                 document.getElementById('typeFilter').value = ''; *@
@*                 document.getElementById('dateFrom').value = ''; *@
@*                 document.getElementById('dateTo').value = ''; *@

@*                 const rows = document.querySelectorAll('.transaction-row'); *@
@*                 rows.forEach(row => { *@
@*                     row.style.display = ''; *@
@*                 }); *@

@*                 calculateStatistics(); *@
@*             } *@

@*             function viewTransactionDetails(transactionId) { *@
@*                 fetch(`@Url.Action("GetTransactionDetails", "Account")?id=${transactionId}`) *@
@*                     .then(response => response.json()) *@
@*                     .then(data => { *@
@*                         if (data.success) { *@
@*                             const transaction = data.data; *@
@*                             const modalContent = ` *@
@*                                 <div class="row"> *@
@*                                     <div class="col-md-6"> *@
@*                                         <h6 class="text-muted">Transaction ID</h6> *@
@*                                         <p class="fw-bold">#${transaction.transactionId}</p> *@
@*                                     </div> *@
@*                                     <div class="col-md-6"> *@
@*                                         <h6 class="text-muted">Date & Time</h6> *@
@*                                         <p class="fw-bold">${new Date(transaction.transactionDate).toLocaleString()}</p> *@
@*                                     </div> *@
@*                                 </div> *@
@*                                 <div class="row"> *@
@*                                     <div class="col-md-6"> *@
@*                                         <h6 class="text-muted">Account Number</h6> *@
@*                                         <p class="fw-bold">${transaction.accountNumber}</p> *@
@*                                     </div> *@
@*                                     <div class="col-md-6"> *@
@*                                         <h6 class="text-muted">Account Type</h6> *@
@*                                         <p class="fw-bold">${transaction.accountType}</p> *@
@*                                     </div> *@
@*                                 </div> *@
@*                                 <div class="row"> *@
@*                                     <div class="col-md-6"> *@
@*                                         <h6 class="text-muted">Transaction Type</h6> *@
@*                                         <p><span class="badge ${transaction.transactionType === 'Credit' ? 'bg-success' : 'bg-danger'}">${transaction.transactionType}</span></p> *@
@*                                     </div> *@
@*                                     <div class="col-md-6"> *@
@*                                         <h6 class="text-muted">Amount</h6> *@
@*                                         <p class="fw-bold ${transaction.transactionType === 'Credit' ? 'text-success' : 'text-danger'}"> *@
@*                                             ${transaction.transactionType === 'Credit' ? '+' : '-'}₦${Math.abs(transaction.amount).toLocaleString('en-NG', {minimumFractionDigits: 2})} *@
@*                                         </p> *@
@*                                     </div> *@
@*                                 </div> *@
@*                                 <div class="row"> *@
@*                                     <div class="col-12"> *@
@*                                         <h6 class="text-muted">Description</h6> *@
@*                                         <p class="fw-bold">${transaction.description}</p> *@
@*                                     </div> *@
@*                                 </div> *@
@*                                 <div class="row"> *@
@*                                     <div class="col-12"> *@
@*                                         <h6 class="text-muted">Balance After Transaction</h6> *@
@*                                         <p class="fw-bold text-primary">₦${transaction.balanceAfterTransaction.toLocaleString('en-NG', {minimumFractionDigits: 2})}</p> *@
@*                                     </div> *@
@*                                 </div> *@
@*                             `; *@
@*                             document.getElementById('transactionDetailsContent').innerHTML = modalContent; *@
@*                             const modal = new bootstrap.Modal(document.getElementById('transactionDetailsModal')); *@
@*                             modal.show(); *@
@*                         } else { *@
@*                             alert('Error loading transaction details: ' + data.message); *@
@*                         } *@
@*                     }) *@
@*                     .catch(error => { *@
@*                         console.error('Error:', error); *@
@*                         alert('Error loading transaction details'); *@
@*                     }); *@
@*             } *@

@*             function exportToCSV() { *@
@*                 const rows = document.querySelectorAll('.transaction-row:not([style*="display: none"])'); *@
@*                 let csv = 'Date,Account Number,Account Type,Description,Type,Amount\n'; *@

@*                 rows.forEach(row => { *@
@*                     const cells = row.querySelectorAll('td'); *@
@*                     const date = row.getAttribute('data-date'); *@
@*                     const accountInfo = cells[1].textContent.trim().replace(/\n/g, ' ').replace(/,/g, ';'); *@
@*                     const description = cells[2].textContent.trim().replace(/,/g, ';'); *@
@*                     const type = row.getAttribute('data-type'); *@
@*                     const amount = row.getAttribute('data-amount'); *@

@*                     csv += `${date},"${accountInfo}","${description}",${type},${amount}\n`; *@
@*                 }); *@

@*                 const blob = new Blob([csv], { type: 'text/csv' }); *@
@*                 const url = window.URL.createObjectURL(blob); *@
@*                 const a = document.createElement('a'); *@
@*                 a.setAttribute('hidden', ''); *@
@*                 a.setAttribute('href', url); *@
@*                 a.setAttribute('download', 'transactions_' + new Date().toISOString().split('T')[0] + '.csv'); *@
@*                 document.body.appendChild(a); *@
@*                 a.click(); *@
@*                 document.body.removeChild(a); *@
@*             } *@

@*             // Real-time search *@
@*             document.getElementById('searchInput').addEventListener('input', function() { *@
@*                 applyFilters(); *@
@*             }); *@

@*             // Auto-apply filters on change *@
@*             document.getElementById('accountFilter').addEventListener('change', applyFilters); *@
@*             document.getElementById('typeFilter').addEventListener('change', applyFilters); *@
@*             document.getElementById('dateFrom').addEventListener('change', applyFilters); *@
@*             document.getElementById('dateTo').addEventListener('change', applyFilters); *@
@*         </script> *@
@* } *@

@* @section Styles { *@
@*         <style> *@
@*             .transaction-row:hover { *@
@*                 background-color: #f8f9fa; *@
@*             } *@

@*             .card { *@
@*                 border-radius: 12px; *@
@*             } *@

@*             .btn { *@
@*                 border-radius: 8px; *@
@*             } *@

@*             .table th { *@
@*                 border-top: none; *@
@*                 font-weight: 600; *@
@*                 color: #495057; *@
@*             } *@

@*             .badge { *@
@*                 font-size: 0.75rem; *@
@*             } *@

@*             .modal-content { *@
@*                 border-radius: 12px; *@
@*             } *@

@*             .form-control, .form-select { *@
@*                 border-radius: 8px; *@
@*             } *@
@*         </style> *@
@* } *@
